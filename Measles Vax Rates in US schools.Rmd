---
title: "Who's Getting Vaccinated for Measles in U.S. Schools?"
author: "*Abby Isaacson*"
date: "3/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

> Could student vaccination rates for Measles, Mumps and Rubella (MMR) possibly predict COVID-19 vaccination rates among children, once a safe child vaccine becomes available?

Measles is disease that was essentially suppressed for 25 years in the U.S. through vaccination, but **showed a significant resurgence** in 2019.

This report examines data from 46,412 schools among 32 states that collected student measles, mumps and rubella (MMR) vaccination data between 2017 and 2019. By looking at how many students have been abiding by state vaccine recommendations for MMR, public health organizations and schools may better target future vaccination outreach efforts for COVID-19 to prevent disease outbreaks among students in the future.

```{r}
library(tidyverse)
library(janitor)
library(skimr)
```

#Get the Data
```{r}
measles <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-25/measles.csv')
```
##*Note: What are other ways of importing data from URL (is this base R)? How can I export the measles dataset to my local device?

```{r}
measles
```
```{r}
measles %>% 
  clean_names()
```
## About Reporting Schools

Thirty-two states reported overall and MMR vaccination rates in the 2017-2018 or 2018-2019 school years, with as many as 16,098 schools reporting from the large state of CA and as few as 230 from small Rhode Island. Among schools that reported school type, most were public (20,692), followed by private and kindergarten only, and then much smaller representation of charter, nonprivate and BOCES (a New York combined education services model).
##Number of Schools Reporting Vaccination Data, by State

```{r}
measles %>% 
  count(state)
```
#schools by type
```{r}
measles %>% 
  count(type) %>% 
  drop_na(type)
```
#Add something about geography, or map school locations TBD

# Average Vaccination Rates Among Schools

The mean vaccination rate for MMR among schools (63%) was slightly higher than the overall reported vaccination rate (54%). Among 14 states with average MMR vaccination rates above 90%, Illinois and Pennsylvania reported the two highest rates (97.4%, 96.9%).  Massachusetts reported the lowest mean vaccination rate (57.7%).

#Mean US Measles Vaccination Rate
```{r}
measles %>% 
  summarize(mean_mmr_rate = mean(mmr))
```
#Mean US Vaccination Rate overall
```{r}
measles %>% 
  summarize(mean_allvax_rate = mean(overall), number_of_responses = n())
```
#Mean Measles Vaccination Rates by State
```{r}
measles %>% 
  group_by(state) %>% 
  summarize(mean_mmr_rate = mean(mmr))
```
##*Note: figure out what negative vaccination rate means

#Mean overall rates by state to see if trends are similar
```{r}
measles %>% 
  group_by(state) %>% 
  summarize(mean_allvax_rate = mean(overall))
```
##*Note: not that helpful to compare to MMR mean rates to overall, since not all states reported the same data...at least not at an exact high and low scale. Graph this later to see where rates are comparable if there appear to be consistent trends (expecting higher MMR than overall based on US average).

#Save the data frame: Mean MMR Vaccination rate by state
```{r}
mean_mmr_by_state <- measles %>% 
  group_by(state) %>% 
  summarize(mean_mmr_rate = mean(mmr))
```
#Mean Vaccination Rates by State and School Type
```{r}
measles %>% 
  group_by(state,type) %>% 
  summarize(mean_mmr_rate = mean(mmr))
```
##*Note: BOCES (Boards of Cooperative Educational Services) is a shared educational service offered in New York.

#US Measles Vaccination Rates by School Type

Mean MMR vaccination rates varied widely by school type. While MA's average vaccination rate was low at 57.7%, its public schools mean rate was 97%, yet 9% among private schools. New York's BOCES (Board of Combined Educational Services) schools reported the highest rates of all school types (98.8%), followed by kindergarten only, public schools, charter and private. Nonpublic types reported the lowest average rate (8.9%).
```{r}
measles %>% 
  group_by(type) %>% 
  drop_na(type) %>% 
  summarize(mean_mmr_rate = mean(mmr))
```
# Exemptions

Among the X schools who reported any type of MMR vaccine exemption (medical, religious or personal), most reported X type exemption. Only 0.2% reported religious exemptions, ...(TBC). Washington is the only state that reported all three types of exemptions (3 personal, 1 religious, 1 medical).
#Figure out what % took any exemption at all

#Percent of All Schools with Religious Exemptions
```{r}
measles %>% 
  count(xrel) 
#%>% mutate(n = 100 * n / sum(n))
```
```{r}
measles %>% 
  count(xmed) 
```
#Add totals
```{r}
measles %>% 
  count(xper)
```

#Percent of Exemptions by State and School Type
```{r}
measles %>% 
  group_by(state) %>% 
  count(state,type,xrel,xmed,xper)
```
##*Note: how to combine or average % for each exemption by type and state would be a next step I'm not ready for.

#Exemptions by State
```{r}
measles %>% 
  group_by(state,xrel,xmed,xper) %>% 
  drop_na(xrel,xmed,xper) %>% 
  summarize(mean_mmr_rate = mean(mmr))
```

install.packages("usethis")
library(usethis)

#-----take this to a repository ------
use_git()

#send to github
use_github(organisation = "rin3-spring-2021", private = TRUE)

# Visualizations Week 4

##Scatterplot of vax rate and personal exemptions

```{r}
ggplot(data = measles,
       mapping = aes(x = mmr, y = xper)) +
  geom_point()
```

###*Note: This isn't the most sensible graph, but one would expect to see fewer exemptions as vaccination rate (mmr) increases. I wonder what's going on with the 100% mmr line, and I also need to figure out what the -1 rate means (and remove? - same below).

##Histograms

```{r}
ggplot(data = measles,
       mapping = aes(x = mmr)) +
  geom_histogram()
```
```{r}
ggplot(data = measles,
       mapping = aes(x = xper)) +
  geom_histogram(bins=100)
```
###*Note: this might be a negative consequence of not cleaning the dataset yet, but there's one WA school that seems to have 169% personal exemption rate, another that reports 100% mmr vax rate AND 83% personal exemption rate...some wacky things going on.  Ultimately this tells me most of the exemption rates are really really small, with the exception of some outliers. I'd like to know more about the outliers in another type of graph, since those will be the target of interest in future COVID vax efforts. 

#filter WA - I need to look up again how to filter
```{r}

```

##Mean MMR vaccination rates by state (bar) *using new data frame

```{r}
mean_mmr_by_state
```
```{r}
ggplot(data = mean_mmr_by_state,
       mapping = aes(x = mean_mmr_rate, y = state))+
  geom_bar(stat = "identity")
```
##Bar Charts v1

```{r}
#measles %>% 
 # drop_na(type)
ggplot(data = measles,
       mapping = aes(x = type, na.rm = TRUE)) +
  geom_bar()

```
###*Note: How do I drop NAs? I tried na.rm = TRUE, and piping drop_na(type) but feel like pipe doesn't work in ggplot?

#Bar Chart v2 MMR by school type

```{r}
mmr_by_type <- measles %>% 
  group_by(type) %>% 
  summarize(mean_mmr = mean(mmr, na.rm = TRUE))
```
```{r}
mmr_by_type
```
```{r}
ggplot(data = mmr_by_type,
       mapping = aes(x = type, y= mean_mmr)) +
  geom_bar(stat = "identity")
  
```
#Again why are N/As still there?

