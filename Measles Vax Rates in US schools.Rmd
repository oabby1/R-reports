---
title: "Who's Getting Vaccinated for Measles in U.S. Schools?"
author: "*Abby Isaacson*"
date: "3/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

> Could student vaccination rates for Measles, Mumps and Rubella (MMR) possibly predict COVID-19 vaccination rates among children, once a safe child vaccine becomes available?

Measles is disease that was essentially suppressed for 25 years in the U.S. through vaccination, but **showed a significant resurgence** in 2019.

This report examines data from 32 states and more than 46,000 schools that reported student measles, mumps and rubella (MMR) vaccination data for kindergarteners between 2017 and 2019. By looking at how many students have been abiding by state vaccine recommendations for MMR, public health organizations and schools may better target future vaccination outreach efforts for COVID-19 to prevent disease outbreaks among students in the future.

```{r}
library(tidyverse)
library(janitor)
library(skimr)
```

#Get the Data
```{r}
#measles <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/da#ta/2020/2020-02-25/measles.csv')

measles_clean_rates <- read_rds("data-top/measles-clean-rates.rds")

measles_exemptions <- read_rds("data-top/measles-exemptions.rds")
```

#CHARLIE: Will my Rmd to talk to my R script file? Or do I need to read in/create the dataframes I like in both? Or, Carrie showed me the source below code, but I get an error message that refers to an unexpected code on line 149?


```{r}
#source("Measles_playground.R")
```

# About Reporting Schools

46,243 schools from 32 states reported overall and/or MMR vaccination rates for their kindergarten classes in the 2017-2018 or 2018-2019 school years. The large state of CA had the most reporting schools (8,052), and the smallest reporting came from Rhode Island (230 schools). 

The majority of reporting schools represented were public, followed by private and kindergarten only, and then much smaller representation of charter, non-private and BOCES (a New York model called Boards of Cooperative Education Services).


```{r}
measles_clean_rates %>% 
  count(type) %>% 
  drop_na(type) %>% 
  arrange(desc(n)) 
```

##Number of Reporting Schools, by Type

```{r}
measles_clean_rates %>% 
  drop_na(type) %>% 
  ggplot(aes(x = type, fill = type)) +
  geom_bar(show.legend = FALSE) +
  scale_fill_brewer(palette = "Set3")
```
##Distribution of schools enrollment
```{r}
measles_clean_rates %>% 
  ggplot(aes(x = enroll)) +
  geom_histogram(bins = 150)
```


# Vaccination Rates Among Reporting Schools
Most individual schools reported MMR vaccination rates well above 75%, while overall vaccination rates were just slightly lower and more unevenly distributed:
```{r}
measles_clean_rates %>% 
  ggplot(aes(x = mmr)) +
  geom_histogram(bins = 100)
```
##Abby to combine side by side histograms (mmr + overall) histogram. dodge? Add titles etc.
```{r}
measles_clean_rates %>% 
  ggplot(aes(x = overall)) +
  geom_histogram(bins = 100)
```

##Mean U.S. Vaccination Rates 
```{r}
mean_mmr_rate <- measles_clean_rates %>% 
  summarize(mean_mmr_rate = mean(mmr, na.rm = TRUE))  %>% 
   pull(mean_mmr_rate) %>% 
   round()
```

```{r}
mean_allvax_rate <- measles_clean_rates %>% 
  summarize(mean_allvax_rate = mean(overall, na.rm = TRUE)) %>% 
  pull(mean_allvax_rate) %>% 
  round()
```

The mean vaccination rates among reporting schools was slightly below the WHO recommended goal of 95% needed to achieve herd immunity. The average MMR rate among reporting schools (`r mean_mmr_rate`%) was slightly higher than the overall reported vaccination rate (`r mean_allvax_rate`%). 

Among the 21 states that reported MMR rates, eight states had average MMR vaccination rates above 95%.  Illinois and Massachusetts reported the two highest rates (97.1%, 96.9%).  Arkansas reported the lowest mean vaccination rate (80.5%). 

Among the 17 states that reported overall vaccination rates, five showed overall vaccination rates at or above 95% with North Carolina leading (96.83%), followed by Iowa (95.8%). Idaho's rate was lowest at 82.4%. California was the only state with sufficient rates for both overall and MMR rates. 

```{r}
mean_mmr_state <- measles_clean_rates %>% 
  group_by(state) %>% 
  summarize(mean_mmr_rate = mean(mmr, na.rm = TRUE)) %>% 
  drop_na() %>% 
  arrange(desc(mean_mmr_rate))
```

```{r}
mean_mmr_by_state_type <- measles_clean_rates %>% 
  group_by(state,type) %>% 
  drop_na(type) %>% 
  summarize(mean_mmr_rate = mean(mmr, na.rm = TRUE)) 
#%>% 
  #round(mean_mmr_rate, digits = 1)
```
##Mean MMR Vaccination Rates, by state

#CHARLIE: Can I plot a vertical mean MMR rate line, among all states (mean_mmr_rate, already a single number) to overlay on this bar graph? I'll do the same for the overall rate graph below
```{r}
ggplot(data = mean_mmr_state,
       mapping = aes(x = mean_mmr_rate, y = state))+
  geom_bar(stat = "identity")
```

##Mean Overall Vax rates, by state 
```{r}
ggplot(data = mean_overall_state,
       mapping = aes(x = mean_allvax_rate, y = state))+
  geom_bar(stat = "identity")
```

##Mean MMR and Overall Rates, by School Type
Mean MMR vaccination rates varied somewhat by school type. BOCES schools in NY reported the highest mean MMR rates, followed closely by public schools (both above 95%). Charter schools averaged the lowest MMR rate (just below 90%). 

Not all school types reported overall vaccination rates, which were lower than MMR rates among types that did report (between 88-93%).
```{r}
mean_mmr_by_type <- measles_clean_rates %>% 
  group_by(type) %>% 
  drop_na(type) %>% 
  summarize(mean_mmr_rate = mean(mmr, na.rm = TRUE)) %>% 
  arrange(desc(mean_mmr_rate))
```

```{r}
mean_overall_by_type <- measles_clean_rates %>% 
  group_by(type) %>% 
  drop_na(type) %>% 
  summarize(mean_overall_rate = mean(overall, na.rm = TRUE)) %>% 
  arrange(desc(mean_overall_rate))
```


```{r}
mean_mmr_by_type %>% 
  left_join(mean_overall_by_type) %>% 
  knitr::kable()
```

##Mean MMR Rates, by School Type
```{r}
mean_mmr_by_type_1 <- mean_mmr_by_type %>% 
   mutate(mmr_type_one_dig = format(round(mean_mmr_rate, 1), nsmall = 1))

ggplot(data = mean_mmr_by_type_1,
       mapping = aes(x = type, y= mean_mmr_rate, fill = type)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  scale_fill_brewer(palette = "Set3") +
  geom_text(aes(label = mmr_type_one_dig),
            vjust = 1.5,
            show.legend = FALSE,
            color = "black") +
  labs(title = "Average MMR Vaccination Rates by School Type",
       x = "School Type",
       y = "Average MMR Rate") +
  theme_classic()
```

# Exemptions (TBD)

The most common type of exemption reported by schools was personal (6312), followed by medical (1003). Religious exemptions were only reported by 109 (0.002%) schools. Washington was the only state that reported all three types.





# States of Interest

States with the lowest rates of MMR vaccinations 

# Conclusions




#GITHUB: take this to a repository

install.packages("usethis")
library(usethis)

use_git()

##send to github
use_github(organisation = "rin3-spring-2021", private = TRUE)
